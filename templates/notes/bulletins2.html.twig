{% extends 'base.html.twig' %}

{% block title %}Bulletin Trimestriel{% endblock %}

{% block body %}
  <style>
    /* Dimensions d'une feuille A4 avec marges réduites */
    .a4 {
      width: 210mm;
      height: auto;
      margin: 0 auto;
      padding: 10mm;
      /* Réduction du padding pour maximiser l'espace */
      background: white;
      font-family: "Arial", sans-serif;
      border: 1px solid #ccc;
      box-shadow: 0 0 5mm rgba(0, 0, 0, 0.1);
      page-break-after: always;
    }

    /* Réduction de la taille des titres */
    .a4 h1 {
      font-size: 24px;
      /* Taille réduite du titre principal */
      margin-bottom: 10px;
      text-align: center;
    }

    .a4 h2 {
      font-size: 20px;
      margin-bottom: 5px;
    }

    .top h1 {
      margin-top: 5px;
    }

    .top h1,
    .top p {
      margin-bottom: -5px;
    }

    /* Ajustement de la taille de la police pour le contenu */
    .a4 p {
      font-size: 13px;
      /* Légère réduction de la taille du texte */
      line-height: 1.4;
      /* Réduction de la hauteur des lignes */
    }

    .a4 small {
      font-size: 11px;
    }

    .top {
      text-align: center;
      margin-bottom: 15px;
    }

    /* Styles pour les tableaux avec ajustement d'espacement */
    .a4 table {
      font-size: 13px;
      /* Taille ajustée pour une meilleure gestion de l'espace */
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }

    .a4 th,
    .a4 td {
      border: 1px solid #000;
      padding: 6px;
      /* Réduction du padding pour compacter le tableau */
    }

    .a4 th {
      background-color: #f5f5f5;
    }

    .a4 tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    /* Ajustement de la largeur des colonnes */
    .a4 th.matiere,
    .a4 td.matiere {
      width: 35%;
      /* Réduction de la largeur de la colonne "Matière" */
      text-align: left;
    }

    .a4 th.appreciation,
    .a4 td.appreciation {
      width: 15%;
      /* Réduction de la largeur de la colonne "Appréciation" */
      text-align: left;
    }

    .a4 th,
    .a4 td {
      width: auto;
    }

    .a4 th {
      height: 10px;
    }

    /* Section des informations de l'élève avec espacement réduit */
    .student {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      /* Espacement réduit entre les éléments */
      grid-auto-rows: minmax(40px, auto);
    }

    .oneitem1 {
      grid-column: 1/4;
    }

    .oneitem2 {
      grid-column: 4/6;
    }

    .a4 li {
      list-style-type: none;
    }

    .a4 .oneitem {
      border: 1px solid #000;
      border-radius: 5px;
    }

    /* Ajustement de la largeur des cellules du tableau personnel */
    .a4 td.label {
      width: 130px;
      /* Réduction de la largeur des labels */
      text-align: right;
      padding-right: 5px;
    }

    .a4 td.value {
      text-align: left;
    }

    /* Ligne de séparation plus fine */
    hr.solid {
      border-top: 1px solid #000;
      margin-top: 10px;
    }

    /* Section de présentation */
    .a4 .presentation {
      width: 100%;
      background-color: #eee;
      padding-top: 2px;
      padding-bottom: 2px;
      margin-bottom: 8px;
      margin-top: 5px;
    }

    /* Section du bilan général avec réduction de l'espacement */
    .a4 .general {
      border: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .a4 .general div:not(:last-child) {
      width: 100%;
      margin-right: 10px;
    }

    /* Tableaux ajustés pour compacter la présentation des données générales */
    .a4 .trimestre,
    .a4 .bilanClasse {
      width: 100%;
    }

    .a4 .bilanGeneral td.label,
    .a4 .trimestre td.label,
    .a4 .bilanClasse td.label {
      width: 90px;
      /* Réduction de la largeur des labels */
      text-align: right;
      padding-right: 3px;
    }

    .petit {
      margin-top: 10px;
    }

    /* Impression */
    @media print {
      .a4 {
        border: none;
        box-shadow: none;
        padding: 0;
        margin: 0;
        width: 210mm; /* Ensure proper size for A4 */
        height: auto; /* Let the content determine the height */
        page-break-after: always;
      }
      .a4:last-child {
        page-break-after: auto; /* Pas de saut de page après le dernier bulletin */
      }

      .no-print {
        display: none;
      }
    }
    .schoolTop{
      display: flex;
    }
    
    .schoolTop .top{
      margin-left: 20px;
    }
    
    .schoolTop .topImg{
      margin-top: -20px;
    }

  </style>
  <body>

    <div class="a4">
    <div class="schoolTop">
      <div class="topImg"><img src="{{ asset('assets/images/logo.png')}}" alt=""></div>
        <div class="top">
          <p><small>République du Bénin</small></p>
          <h1>{{ etablissement.nom }}</h1>
          <p>
            {{ etablissement.adresse }} Tel : {{ etablissement.telephone }}
          </p>
          <p><strong>Abomey-Calavi</strong></p>
          <p>{{ etablissement.devise }}</p>
        </div>
    </div>
      <hr class="solid" />
      <div class="student">
        <div class="oneitem oneitem1 personnel">
          <table>
            <tr>
              <td class="label">Nom :</td>
              <td class="value">{{ eleve.nom }}</td>
            </tr>
            <tr>
              <td class="label">Prénom :</td>
              <td class="value">{{ eleve.prenom }}</td>
            </tr>
            <tr>
              <td class="label">Sexe :</td>
              <td class="value">{{ eleve.sexe | upper }}</td>
            </tr>
          </table>
        </div>
        <div class="oneitem oneitem2 classe">
          <table>
            <tr>
              <td class="label">Classe :</td>
              <td class="value">{{ eleve.classe }}</td>
            </tr>
            <tr>
              <td class="label">Effectif :</td>
              <td class="value">{{ eleve.effectif }}</td>
            </tr>
            <tr>
              <td class="label">Année scolaire :</td>
              <td class="value">{{ eleve.annee }}</td>
            </tr>
          </table>
        </div>
        <div class="oneitem oneitem3 vide"></div>
      </div>

      <div class="presentation">
        <h1>BULLETIN DE NOTE DU 
        {% if trimestre == 1 %}
            PREMIER
        {% elseif trimestre == 2%}
            DEUXIEME
        {% else %}
            TROISIEME
        {% endif %}
         TRIMESTRE</h1>
      </div>
      <div class="bulletin">
        <table>
          <thead>
            <tr>
              <th class="matiere">Matière</th>
              <th>Coef</th>
              <th>MI</th>
              <th>Devoir 1</th>
              <th>Devoir 2</th>
              <th>DH</th>
              <th>Moy/20</th>
              <th>Moy*Coef</th>
              <th>Rang</th>
              <th>Moy Fble</th>
              <th>Moy Frte</th>
              <th class="appreciation">Appréciation</th>
            </tr>
          </thead>

          <tbody>
            {% for ligne in notes %}
            <tr>
              <td class="matiere">{{ ligne.matiere }}</td>
              <td>{{ ligne.coef }}</td>
              <td>{{ ligne.MI ?? '-' }}</td>
              <td>{{ ligne.D1 ?? '-' }}</td>
              <td>{{ ligne.D2 ?? '-' }}</td>
              <td>{{ ligne.DH ?? '-' }}</td>
                    <td>{{ ligne.moyenne ?? '-' }}</td>
                    <td>{{ ligne.totalCoef ?? '-' }}</td>
                    <td>{{ ligne.rang ?? '-' }}</td>
                    <td>{{ ligne.moyFort ?? '-' }}</td>
                    <td>{{ ligne.moyFaible ?? '-' }}</td>
                <td class="appreciation">
                    {{ ligne.appreciation ?? '' }}
                </td>
              {% else %}
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="general">
        <div class="bilanGeneral">
          <table>
            <thead>
              <tr>
                <td colspan="2">Billan de l'élève</td>
              </tr>
            </thead>
            <tr>
              <td class="label">Moyenne</td>
              <td class="value">{{ bilan.moyenneGenerale }}</td>
            </tr>
            <tr>
              <td class="label">Rang</td>
              <td class="value">
                {{ bilan.rang }}
                {% if bilan.rang == 1 and eleve.sexe|lower == "f" %}
                    ère 
                {% endif %} 
                {% if bilan.rang == 1 and eleve.sexe|lower == "m" %}
                    er 
                {% endif %} 
                {% if bilan.rang !=  1 %}ème{% endif %}
              </td>
            </tr>
          </table>
        </div>

        {% if trimestre == 3 %}
        <div class="trimestre mx-4">
          <table>
            <thead>
              <tr>
                <th>Trimestre</th>
                <th>Moyenne</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1er Trimestre</td>
                <td>{{ results1[key]["moyenneGenerale"] }}</td>
              </tr>
              <tr>
                <td>2e Trimestre</td>
                <td>{{ results2[key]["moyenneGenerale"] }}</td>
              </tr>
              <tr>
                <td>Général</td>
                <td>
                  {{ ((results1[key]["moyenneGenerale"] + results2[key]["moyenneGenerale"] + result["moyenneGenerale"]) / 3) | round(2, 'floor') }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        {% endif %}
        <div class="bilanClasse">
          <table>
            <thead>
              <tr>
                <td colspan="2">Billan de la classe</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Moyenne forte</td>
                <td>{{ bilan.moyenneForte }}</td>
              </tr>

              <tr>
                <td>Moyenne faible</td>
                <td>{{ bilan.moyenneFaible }}</td>
              </tr>
              <tr>
                <td>Moyenne de la classe</td>
                <td>{{ bilan.moyenneClasse }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="note mb-4">
        <table>
          <thead>
            <tr>
              <th colspan="2">Distinctions et Sanctions</th>
              <th>appreciation du Conseil des Professeurs</th>
              <th>Signature du directeur des études</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Félicitations</td>
              <td></td>
              <td rowspan="6">
                <h1>
                    <strong>Distinctions et Sanctions</strong><br>
                    <label><input type="checkbox" {% if mentions.felicitations %}checked{% endif %}> Félicitations</label><br>
                    <label><input type="checkbox" {% if mentions.encouragement %}checked{% endif %}> Encouragement</label><br>
                    <label><input type="checkbox" {% if mentions.passable %}checked{% endif %}> Passable</label><br>
                    <label><input type="checkbox" {% if mentions.tableauHonneur %}checked{% endif %}> Tableau d'honneur</label><br>
                    <label><input type="checkbox" {% if mentions.avertissement %}checked{% endif %}> Avertissement</label><br>
                    <label><input type="checkbox" {% if mentions.blame %}checked{% endif %}> Blâme</label>
                </h1>
              </td>
              <td rowspan="6"></td>
            </tr>

            <tr>
              <td>Encouragement</td>
              <td></td>
            </tr>
            <tr>
              <td>Tableau d'honneur</td>
              <td></td>
            </tr>
            <tr>
              <td>Avertissement</td>
              <td></td>
            </tr>
            <tr>
              <td>Blâme</td>
              <td></td>
            </tr>
            <tr>
              <td>Exclu</td>
              <td></td>
            </tr>
          </tbody>
        </table>
        <div class="petit">
          <small>
            <strong>Mi : </strong> Moyenne Interrogation -
            <strong>DH : </strong> Devoir hebdomadaire
          </small>
        </div>
      </div>
    </div>

    <script>
      window.onload = function () {
        window.print();
      };
    </script>

{% endblock %}
